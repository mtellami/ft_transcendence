generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
	id					Int		  	@id @default(autoincrement())
	intraId     Int 			@unique

	username 		String	 	@unique
	avatar 			String
	twoFactor 	Boolean 	@default(false)

	email				String 
	fullName  	String?
	phoneNumber Int?

	friends			User[] 		@relation("friends")
	friendOf		User[] 		@relation("friends")
	blocks			User[] 		@relation("blocks")
	blockBy			User[] 		@relation("blocks")

	games	 			Int?	 		@default(0)
	wins 	 			Int?   		@default(0)
	score 			Int?   		@default(0)
	online 			Boolean 	@default(false)

	rooms 			Room[]		@relation("joined")
	roomsAdmin  Room[]		@relation("admin")
	bannedFrom 	Room[]		@relation("banned")

	messages 		Message[] @relation("author")
}

model Room {
	id					Int  			@id @default(autoincrement())
	createdAt 	DateTime 	@default(now())

	name 				String 		@unique
	type 				String
	password 		String?

	admins 			User[] 		@relation("admin")
	users 			User[] 		@relation("joined")
	banned 			User[]		@relation("banned")

	messages 		Message[]
}

model Message {
	id					Int  			@id @default(autoincrement())
	createdAt 	DateTime 	@default(now())
	content 		String

	authorName 	String
	author 			User  		@relation("author", fields: [authorName], references: [username])

	roomId 			Int
	room 				Room 			@relation(fields: [roomId], references: [id])
}

